name: Issue â†’ Claudeé–‹ç™º è‡ªå‹•ãƒˆãƒªã‚¬ãƒ¼

on:
  issues:
    types: [opened, edited]
  issue_comment:
    types: [created]

jobs:
  analyze_issue:
    runs-on: ubuntu-latest
    if: |
      (github.event_name == 'issues' && contains(github.event.issue.body, '/claude')) ||
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '/claude'))
    
    steps:
      - name: Issueåˆ†æã¨ãƒ©ãƒ™ãƒ«ä»˜ã‘
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const body = issue.body || '';
            
            // æŠ€è¡“è¦ä»¶ã®è‡ªå‹•åˆ¤å®š
            const isTechnical = /^(feat|fix|refactor|perf|test|docs):/i.test(issue.title) ||
                              body.includes('## æŠ€è¡“è¦ä»¶') ||
                              body.includes('## Technical Requirements');
            
            if (isTechnical) {
              // claude-dev ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ 
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: ['claude-dev', 'auto-development']
              });
              
              // Notioné€£æºã‚³ãƒ¡ãƒ³ãƒˆ
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                body: `ğŸ¤– Claude Codeé–‹ç™ºãŒé–‹å§‹ã•ã‚Œã¾ã™\n\n` +
                      `ğŸ“‹ Notionè¦ä»¶: [ãƒªãƒ³ã‚¯ã‚’ç¢ºèª](notion-link)\n` +
                      `ğŸ”§ æŠ€è¡“Issue: #${issue.number}\n` +
                      `âš¡ è‡ªå‹•é–‹ç™ºã‚’é–‹å§‹ã—ã¾ã™...`
              });
              
              // ä¸¦åˆ—é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒˆãƒªã‚¬ãƒ¼
              await github.rest.actions.createWorkflowDispatch({
                owner: context.repo.owner,
                repo: context.repo.repo,
                workflow_id: 'claude-parallel-dev.yml',
                ref: 'main',
                inputs: {
                  issue_number: issue.number.toString()
                }
              });
            }
